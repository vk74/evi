# Version: 1.5.1
# Purpose: Production deployment configuration template for evi (NON-SECRET values).
# Deployment file: evi.template.env
# Logic: User edits this file and uses it with `evictl` to render Quadlet units and proxy config.
#
# Changes in v1.5.1:
# - EVI_*_IMAGE use ghcr.io/vk74/... (personal GHCR namespace); align with release publish
#
# Changes in v1.5.0:
# - Added EVI_FE_API_URL configuration for frontend API URL (default: /api)
# - This fixes frontend-backend connection in production builds
#
# Changes in v1.4.0:
# - Removed deprecated "internal" TLS mode (only manual and letsencrypt supported)
# - Updated documentation to reflect guided setup workflow
#
# Changes in v1.3.0:
# - Updated internal deployment scenario to use manual mode with generated certificates
# - Added documentation for TLS certificate generation via install.sh
#
# ============================
# Configuration Scenarios
# ============================
#
# Use install.sh -> "guided setup" for interactive configuration, or edit this file directly.
#
# 1. Internal Use (Private IP / Intranet Domain)
#    - EVI_DOMAIN=192.168.1.10 or evi.local
#    - EVI_TLS_MODE=manual
#    -> Workflow: install.sh will auto-generate self-signed certificates
#    -> Result: HTTPS works. Browser warning (acceptable) or install evi-tls.crt on clients.
#
# 2. Public Domain (Let's Encrypt)
#    - EVI_DOMAIN=example.com
#    - EVI_TLS_MODE=letsencrypt
#    - EVI_ACME_EMAIL=admin@example.com
#    -> Prerequisites: DNS must point to server, ports 80/443 open to internet
#    -> Result: Automatic trusted HTTPS certificate
#
# 3. Custom Certificates (Corporate / Existing)
#    - EVI_DOMAIN=my-secure-site.com
#    - EVI_TLS_MODE=manual
#    -> Place cert.pem and key.pem in dev-ops/common/env/tls/
#    -> Result: Uses your certificates
#
# =========================
# Core
# =========================

# Public domain or IP for accessing the application.
EVI_DOMAIN=evi.example.com

# TLS Mode:
# - "letsencrypt": Automatic public certs via Let's Encrypt (for public domains).
#                  Requires ports 80/443 open to internet and valid DNS.
# - "manual":      Use certificates from dev-ops/common/env/tls/ (RECOMMENDED for internal/LAN).
#                  Run install.sh -> guided setup to auto-generate self-signed certificates.
EVI_TLS_MODE=letsencrypt

# [For 'manual' mode only] Paths to your certificate files.
# You can use absolute paths or paths relative to the 'evictl' script location.
# Example: If files are in the evi/deployment folder, just use the filename.
EVI_TLS_CERT_PATH=
EVI_TLS_KEY_PATH=

# [For 'letsencrypt' mode only] Contact email for certificate notifications (recommended).
EVI_ACME_EMAIL=admin@example.com

# Host ports (Caddy is the only container binding these ports)
# Traffic flow:
# - Port 80: Redirects to HTTPS. Must be open for Let's Encrypt validation.
# - Port 443: Secure application traffic.
EVI_HTTP_PORT=80
EVI_HTTPS_PORT=443

# =========================
# Images (registry references)
# =========================

# Reverse proxy (Caddy)
EVI_PROXY_IMAGE=docker.io/caddy:2.8-alpine

# Application images (GHCR; namespace evi-app or your username for personal registry)
EVI_FE_IMAGE=ghcr.io/vk74/evi-fe:0.11.7
EVI_BE_IMAGE=ghcr.io/vk74/evi-be:0.11.7
EVI_DB_IMAGE=ghcr.io/vk74/evi-db:0.11.7

# =========================
# Networking (internal)
# =========================

# Podman network name for internal communication (bridge) between containers
EVI_NETWORK=evi-net

# Backend internal port (not published on host; Caddy proxies to it)
EVI_BE_PORT=3000

# Frontend internal port (nginx in evi-fe image)
EVI_FE_PORT=80

# Database internal port
EVI_DB_PORT=5432

# =========================
# Backend configuration
# =========================

# NODE_ENV inside the backend container
EVI_NODE_ENV=production

# CORS allowed origins (comma-separated). Must include https://<domain>.
# Defaults to your EVI_DOMAIN using variable expansion.
EVI_CORS_ORIGINS=https://${EVI_DOMAIN}

# =========================
# Frontend configuration
# =========================

# Frontend API URL (relative path for reverse proxy)
# Default: /api (works with Caddy reverse proxy routing)
# Change only if you have custom routing configuration
EVI_FE_API_URL=/api

# =========================
# Database configuration (non-secret)
# =========================

EVI_POSTGRES_DB=maindb
EVI_POSTGRES_USER=app_service

# Demo data seeding (true/false)
EVI_SEED_DEMO_DATA=false

# =========================
# Resource limits (optional)
# =========================

# Examples: "0.5", "1", "2"
EVI_LIMIT_CPU_PROXY=
EVI_LIMIT_CPU_FE=
EVI_LIMIT_CPU_BE=
EVI_LIMIT_CPU_DB=

# Examples: "512m", "1g", "2g"
EVI_LIMIT_MEM_PROXY=
EVI_LIMIT_MEM_FE=
EVI_LIMIT_MEM_BE=
EVI_LIMIT_MEM_DB=

# =========================
# Optional pgAdmin (disabled by default)
# =========================

EVI_PGADMIN_ENABLED=false
EVI_PGADMIN_IMAGE=docker.io/dpage/pgadmin4:8
# Bind pgAdmin on localhost only (recommended)
EVI_PGADMIN_HOST=127.0.0.1
EVI_PGADMIN_PORT=5445
EVI_PGADMIN_EMAIL=evidba@pgadmin.app
