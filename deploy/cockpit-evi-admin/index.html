<!DOCTYPE html>
<!-- Version: 1.3.1 -->
<!-- Cockpit package: EVI administration panel with left navigation and right content area. -->
<!-- Provides admin tools: full backup, password management (coming soon), certificate management (coming soon). -->
<!-- Cockpit package; filename: index.html -->
<!--
  Changes in v1.3.1:
  - Default backup path changed to ~/evi/config/backup (deploy kit / runtime config split).
  Changes in v1.3.0:
  - Backup progress bar (animated, step counter) between status and output
  - Encryption password field: input group with show/hide password button (eye icon)
  Changes in v1.2.0:
  - Pre-filled backup location with ~/evi/config/backup default
  - Added note about restore instructions README being created alongside backup
  - Estimate Size now renders human-readable formatted summary instead of raw JSON
  Changes in v1.1.0:
  - Removed ../base1/patternfly.css (not available in all Cockpit versions)
  - Dark/light theme synced from Cockpit shell via evi-admin.js
-->
<html>
<head>
  <meta charset="utf-8">
  <title>evi admin tools</title>
  <link rel="stylesheet" href="evi-admin.css" type="text/css">
</head>
<body>
  <div class="evi-admin">
    <!-- Header -->
    <header class="evi-admin-header">
      <h1>evi admin tools</h1>
    </header>

    <div class="evi-admin-body">
      <!-- Left navigation panel -->
      <nav class="evi-admin-nav">
        <ul class="evi-admin-nav-list">
          <li class="evi-admin-nav-item active" data-section="backup">
            <span class="evi-admin-nav-icon">&#128230;</span>
            <span class="evi-admin-nav-label">Full Backup</span>
          </li>
          <li class="evi-admin-nav-item disabled" data-section="passwords">
            <span class="evi-admin-nav-icon">&#128273;</span>
            <span class="evi-admin-nav-label">Password Management</span>
            <span class="evi-admin-badge">coming soon</span>
          </li>
          <li class="evi-admin-nav-item disabled" data-section="certificates">
            <span class="evi-admin-nav-icon">&#128274;</span>
            <span class="evi-admin-nav-label">Certificate Management</span>
            <span class="evi-admin-badge">coming soon</span>
          </li>
        </ul>
      </nav>

      <!-- Right content panel -->
      <main class="evi-admin-content">
        <!-- === Backup Section === -->
        <div id="section-backup" class="evi-admin-section active">
          <h2>Full Backup</h2>
          <p class="evi-admin-description">
            Create a complete backup of all EVI components: container images, database,
            environment configuration, TLS certificates, JWT secrets, and installation scripts.
            The backup set is self-contained and can be used to restore EVI on any compatible server.
            A restore instructions file (README-RESTORE-STEP-BY-STEP.md) will be created
            alongside the backup with step-by-step recovery guide.
          </p>

          <form class="evi-admin-form" autocomplete="off">
            <!-- Backup location -->
            <div class="evi-admin-form-group">
              <label for="backup-dir">Backup location</label>
              <input type="text" id="backup-dir" class="evi-admin-input"
                     value="~/evi/config/backup"
                     placeholder="e.g. /home/user/evi/config/backup">
              <span class="evi-admin-hint">Directory where backup files will be created</span>
            </div>

            <!-- Compression -->
            <div class="evi-admin-form-group">
              <label for="backup-compression">Compression method</label>
              <select id="backup-compression" class="evi-admin-select">
                <option value="gzip-standard">gzip &mdash; standard (default)</option>
                <option value="zstd-fast">zstd &mdash; fast</option>
                <option value="zstd-max">zstd &mdash; max compression</option>
              </select>
            </div>

            <!-- Encryption toggle -->
            <div class="evi-admin-form-group evi-admin-form-group-checkbox">
              <label class="evi-admin-checkbox-label">
                <input type="checkbox" id="backup-encrypt">
                <span>Encrypt backup with password</span>
              </label>
            </div>

            <!-- Password (shown when encrypt is checked) -->
            <div id="password-group" class="evi-admin-form-group hidden">
              <label for="backup-password">Encryption password</label>
              <div class="evi-admin-input-group">
                <input type="password" id="backup-password" class="evi-admin-input"
                       placeholder="Enter password for backup encryption">
                <button type="button" id="btn-toggle-password" class="evi-admin-btn-toggle-password" title="Show password" aria-label="Show password">
                  <svg class="evi-admin-icon-eye" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                  <svg class="evi-admin-icon-eye-off hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                </button>
              </div>
              <span class="evi-admin-hint">The password will be required to restore the backup</span>
            </div>

            <!-- Action buttons -->
            <div class="evi-admin-form-actions">
              <button type="button" id="btn-backup-start" class="evi-admin-btn evi-admin-btn-primary">
                Start Full Backup
              </button>
              <button type="button" id="btn-backup-estimate" class="evi-admin-btn evi-admin-btn-secondary">
                Estimate Size
              </button>
            </div>
          </form>

          <!-- Status indicator -->
          <div id="backup-status" class="evi-admin-status hidden"></div>

          <!-- Progress bar (shown during backup) -->
          <div id="backup-progress" class="evi-admin-progress-wrapper hidden">
            <div class="evi-admin-progress-bar">
              <div id="backup-progress-fill" class="evi-admin-progress-fill"></div>
            </div>
            <div id="backup-progress-text" class="evi-admin-progress-text">Backup in progress...</div>
          </div>

          <!-- Output area -->
          <div id="backup-output-wrapper" class="evi-admin-output-wrapper hidden">
            <div class="evi-admin-output-header">
              <h3>Output</h3>
              <button type="button" id="btn-backup-clear" class="evi-admin-btn evi-admin-btn-small">Clear</button>
            </div>
            <pre id="backup-output" class="evi-admin-output"></pre>
          </div>
        </div>

        <!-- === Password Management Section === -->
        <div id="section-passwords" class="evi-admin-section hidden">
          <h2>Password Management</h2>
          <div class="evi-admin-placeholder">
            <span class="evi-admin-placeholder-icon">&#128273;</span>
            <p>Password management tools will be available in a future update.</p>
            <p class="evi-admin-placeholder-hint">
              Planned features: reset database passwords, regenerate JWT secrets,
              update pgAdmin credentials.
            </p>
          </div>
        </div>

        <!-- === Certificate Management Section === -->
        <div id="section-certificates" class="evi-admin-section hidden">
          <h2>Certificate Management</h2>
          <div class="evi-admin-placeholder">
            <span class="evi-admin-placeholder-icon">&#128274;</span>
            <p>Certificate management tools will be available in a future update.</p>
            <p class="evi-admin-placeholder-hint">
              Planned features: view current certificates, regenerate self-signed certificates,
              import custom certificates, check certificate expiry.
            </p>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script src="../base1/cockpit.js"></script>
  <script src="evi-admin.js"></script>
</body>
</html>
