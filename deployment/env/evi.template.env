# Version: 1.3.0
# Purpose: Production deployment configuration template for evi (NON-SECRET values).
# Deployment file: evi.template.env
# Logic: User edits this file and uses it with `evictl` to render Quadlet units and proxy config.
#
# Changes in v1.3.0:
# - Updated internal deployment scenario to use manual mode with generated certificates
# - Added documentation for TLS certificate generation via install.sh
# - Deprecated "internal" TLS mode recommendation (browser compatibility issues)
#
# Changes in v1.2.0:
# - Added detailed info about Let's Encrypt renewal and process.
# - Clarified requirements for ports 80 & 443.
# - Simplified manual TLS instructions (relative paths).
# - Clarified "Internal" mode behavior regarding CA.
# - Expanded comments for clarity and AI-agent friendliness.
#
# ============================
# Examples of Config Scenarios
# ============================
#
# 1. Internal IP (Private Network / VM / LAN) - RECOMMENDED FOR INTERNAL USE
#    - EVI_DOMAIN=<your-server-ip> (e.g., 192.168.1.10)
#    - EVI_TLS_MODE=manual
#    -> Workflow:
#       1. Run install.sh
#       2. Go to "TLS Certificates" menu
#       3. Select "Generate Certificates" - this will automatically:
#          - Generate Root CA and server certificate with proper SAN for IP addresses
#          - Create client-installable CA (evi-tls.crt) to eliminate browser warnings
#          - Update EVI_TLS_MODE to "manual" and configure certificate paths
#    -> Result: HTTPS works. Browsers will show a security warning (acceptable).
#    -> Optional: Install evi-tls.crt on client devices to eliminate warnings.
#
# 2. Internal Domain (Intranet / Local DNS)
#    - EVI_DOMAIN=evi.local
#    - EVI_TLS_MODE=manual
#    -> Same workflow as #1. Use install.sh -> TLS Certificates menu to generate certificates.
#    -> Certificates will include proper SAN for your domain name.
#
# 3. Public Domain (Production / Internet)
#    - EVI_DOMAIN=example.com
#    - EVI_TLS_MODE=letsencrypt
#    -> Result: Valid public HTTPS certificate trusted by all browsers.
#    -> PREREQUISITE: Your domain DNS MUST point to this server's Public IP.
#    -> PREREQUISITE: Ports 80 AND 443 MUST be open and reachable on the host server from the internet.
#
#    [About Let's Encrypt]
#    - How it works: Caddy automatically contacts Let's Encrypt, proves domain ownership via HTTP (port 80),
#      and downloads the certificate.
#    - Validity: Certificates are valid for 90 days.
#    - Renewal: AUTOMATIC. Caddy renews them ~30 days before expiration without downtime. No manual action needed.
#    - Force renewal: If you need to reset, delete the 'evi_caddy_data' volume or use 'evictl' (future feature).
#
# 4. Custom Certificate (Corporate / Existing)
#    - EVI_DOMAIN=my-secure-site.com
#    - EVI_TLS_MODE=manual
#    - EVI_TLS_CERT_PATH=./fullchain.pem
#    - EVI_TLS_KEY_PATH=./privkey.pem
#    -> Instruction: Place your .pem files in the deployment/env/ directory.
#    -> Or place them in deployment/env/tls/ as cert.pem and key.pem for auto-detection.
#    -> Result: The system imports these files. Useful if you have a wildcard cert or corporate CA.
#
# NOTE: "internal" TLS mode exists but is NOT RECOMMENDED due to browser compatibility issues
#       with Caddy's internal PKI in containerized environments. Use "manual" mode instead.
#
# =========================
# Core
# =========================

# Public domain or IP for accessing the application.
EVI_DOMAIN=evi.example.com

# TLS Mode:
# - "letsencrypt": Automatic public certs (for public domains, requires ports 80/443 open to internet).
# - "manual":      Use certificates from deployment/env/tls/ or custom paths (RECOMMENDED for internal/LAN).
#                  Use install.sh -> TLS Certificates menu to generate self-signed certificates.
# - "internal":    [DEPRECATED] Caddy's internal PKI. Not recommended due to browser compatibility issues.
EVI_TLS_MODE=letsencrypt

# [For 'manual' mode only] Paths to your certificate files.
# You can use absolute paths or paths relative to the 'evictl' script location.
# Example: If files are in the evi/deployment folder, just use the filename.
EVI_TLS_CERT_PATH=
EVI_TLS_KEY_PATH=

# [For 'letsencrypt' mode only] Contact email for certificate notifications (recommended).
EVI_ACME_EMAIL=admin@example.com

# Host ports (Caddy is the only container binding these ports)
# Traffic flow:
# - Port 80: Redirects to HTTPS. Must be open for Let's Encrypt validation.
# - Port 443: Secure application traffic.
EVI_HTTP_PORT=80
EVI_HTTPS_PORT=443

# =========================
# Images (registry references)
# =========================

# Reverse proxy (Caddy)
EVI_PROXY_IMAGE=docker.io/caddy:2.8-alpine

# Application images (you will publish these to a registry)
EVI_FE_IMAGE=ghcr.io/evi-app/evi-fe:latest
EVI_BE_IMAGE=ghcr.io/evi-app/evi-be:latest
EVI_DB_IMAGE=ghcr.io/evi-app/evi-db:latest

# =========================
# Networking (internal)
# =========================

# Podman network name for internal communication (bridge) between containers
EVI_NETWORK=evi-net

# Backend internal port (not published on host; Caddy proxies to it)
EVI_BE_PORT=3000

# Frontend internal port (nginx in evi-fe image)
EVI_FE_PORT=80

# Database internal port
EVI_DB_PORT=5432

# =========================
# Backend configuration
# =========================

# NODE_ENV inside the backend container
EVI_NODE_ENV=production

# CORS allowed origins (comma-separated). Must include https://<domain>.
# Defaults to your EVI_DOMAIN using variable expansion.
EVI_CORS_ORIGINS=https://${EVI_DOMAIN}

# =========================
# Database configuration (non-secret)
# =========================

EVI_POSTGRES_DB=maindb
EVI_POSTGRES_USER=app_service

# Demo data seeding (true/false)
EVI_SEED_DEMO_DATA=false

# =========================
# Resource limits (optional)
# =========================

# Examples: "0.5", "1", "2"
EVI_LIMIT_CPU_PROXY=
EVI_LIMIT_CPU_FE=
EVI_LIMIT_CPU_BE=
EVI_LIMIT_CPU_DB=

# Examples: "512m", "1g", "2g"
EVI_LIMIT_MEM_PROXY=
EVI_LIMIT_MEM_FE=
EVI_LIMIT_MEM_BE=
EVI_LIMIT_MEM_DB=

# =========================
# Optional pgAdmin (disabled by default)
# =========================

EVI_PGADMIN_ENABLED=false
EVI_PGADMIN_IMAGE=docker.io/dpage/pgadmin4:8
# Bind pgAdmin on localhost only (recommended)
EVI_PGADMIN_HOST=127.0.0.1
EVI_PGADMIN_PORT=5050
